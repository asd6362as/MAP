<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=big5">
  <title>緊急聯絡人資料</title>

  <script type="text/javascript">
    var strUrl=location.search;
    var getPara, ParaVal;
    var aryPara = [];
    var surl2,surl3;
   window.onload = function () {
     localStorage.setItem("選取聯絡人","?name1= &blood= &allergen= &ggname= &ggphone= &ggemail= ");
     sl =sessionStorage.length;
      if(localStorage.getItem("SURL") === null){
       localStorage.setItem("SURL","^?name1= &blood= &allergen= &ggname= &ggphone= &ggemail= ");
     }
     surl2 = localStorage.getItem("SURL");
     if(surl2 !== null){
     surl3 = surl2.split("^");
     }
     ReadOption();
      if (sl>3){
        ds(theList);
      }
    }
  </script>
</head>

<body>
  <script
      type="text/javascript"
    ></script>

  <div id="top" style="
        background-color: #a52a2a;
        color: white;
        font-size: 44px;
        position: relative;
        width: 100vw;
        height: 56px;
        margin: -8px 0px 0px -8px;
      ">
    緊急救援資訊<input id="EC1" type="button" value="📝"
      style="width: 40px;height: 40px; right:10px;top: 8px; position: absolute;border: none; background-color: #a52a2a;font-size: 25px;"
      onClick="location.href='test2.html'" />

  </div>
  <script>
function ReadOption() {
  len1 =localStorage.length;
  for (i = 0 ; i<len1 ; i++){
  s = localStorage.key(i);
  ss =localStorage.getItem(s);
  var sss=ss.startsWith("?name");
  if(sss == true){
  if(ss !== surl3[1]){
  addOption1(theList,s,ss,false);
  }
else if(ss === surl3[1]){
  var s1 = s
  var ss1 = ss;
}}}
addOption1(theList,s1,ss1,true);
add1();
}
function add1() {
    var o = document.getElementById('theList');
    len = o.length;
    tx=[]
    for (i=0 ; i<len ; i++){
    tx.push(o[i].text);
    }
}
function addOption1(list, text, value){
	var index=list.options.length;
	list.options[index]=new Option(text, value);
	list.selectedIndex=index;
}
function addOption(list, text, value, selected){
  add1();
  if(text !=null){
  var n = tx.includes(text);
  if(n == false){
	var index=list.options.length;
	list.options[index]=new Option(text, value, selected);
	list.selectedIndex=index;
}}
}
 function ds(list) {
    var index=list.selectedIndex;
    var te1=list.options[index].text;
    var v1=list.options[index].value;
    localStorage.setItem("SURL", "^"+v1);
        if (v1.indexOf("?") != -1) {
          var getSearch = v1.split("?");
          getPara = getSearch[1].split("&");
          for (var i = 0; i < getPara.length; i++) {
            ParaVal = getPara[i].split("=");
            aryPara.push(ParaVal[0]);
            aryPara[ParaVal[0]] = decodeURI(ParaVal[1]);
          }
          //var change_email=aryPara["ggemail"].split("%40");
         // aryPara["ggemail"]=change_email[0]+"@"+change_email[1];
          for (var i = 0; i < aryPara.length; i++) {
            sessionStorage.setItem(aryPara[i],aryPara[aryPara[i]])
          }
        }


        document.getElementById("name1").innerText=sessionStorage.getItem("name1");
        document.getElementById("blood").innerText=sessionStorage.getItem("blood");
        document.getElementById("allergen").innerText=sessionStorage.getItem("allergen");
        document.getElementById("ggname").innerText=sessionStorage.getItem("ggname");
        document.getElementById("ggphone").innerText=sessionStorage.getItem("ggphone");
        document.getElementById("ggemail").innerText=sessionStorage.getItem("ggemail");
  }
</script>


  <form>
  <h1>選取聯絡人<br><h1>
	<select id=theList width="200" onclick="ds(theList)" style="width: 120px">
</select>
<p>
  <hr />
    <h2>個人資訊</h2>
    姓名:<div id="name1"></div>
    血型:<div id="blood"></div>
    過敏原:<div id="allergen"></div>
    <hr />
    <h2>聯絡人資訊</h2>
    姓名:<div id="ggname"></div>
    手機:<div id="ggphone"></div>
    Email:<div id="ggemail"></div>
</form>

  <input id="EC1" type="button" value=" " style="
          position: absolute;
          width: 120px;
          height: 40px;
          border: none;
          right: 0px;
          bottom: 5%;
          background-image: url(botton/bm1.png);
        "
      ontouchstart="this.style.background ='url(botton/bm2.png)';"
      ontouchend="this.style.background ='url(botton/bm1.png)';"
      onmousedown="this.style.background ='url(botton/bm2.png)';"
      onmouseup="this.style.background='url(botton/bm1.png)';"
      onmouseout="this.style.background='url(botton/bm1.png)';"
      onClick="location.href='index.html'" />


</body>

</html>